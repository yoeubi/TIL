# crypto 단반향 암호화

- 다양한 암호화를 도와주는 모듈이다.

- 비밀번호는 hash방식으로 암호화해 복호화 되지 않는 문자열을 만듭니다.

```js
const crypto = require('crypto');

crypto.createHash('sha512').update('비밀번호').digest('base64');
```

- `createHash`는 해쉬라는 것을 만든다. `sha512`는 알고리즘 이름이다. `sha512`로 알고리즘을 만든다.

- `update` 이부분에 암호화 하고 싶은 것을 넣는다. 

- `digest`는 어떤 방식으로 보여질지 정해준다. base64 로 보여준다.

- 비밀번호를 해쉬로 암호화하면 복호화 할수 없다.

- 비밀번호는 복호화할 이유가 없다.

- 비밀번호는 복호화할수 없는 해쉬방식으로 하고 비밀번호를 다시 암호화해서 값을 비교하는 것이다. 

- 암호문(해시)을 저장한 후 사용자의 입력 비밀번호를 암호화한 것과 비교합니다.

- 이런걸 단방향 암호화라고 한다.

- 이값은 노출되어도 원래 비밀번호를 찾아낼수 없다.

- 다른 비밀번호를 해도 똑같은 암호화가 나올수 있다 이것을 비밀번호 충돌이라고 한다. 

- 똑같은 암호해쉬를 찾는 공격을 한다. 비밀번호가 짧고 쉬울수록 공격에 취약하다.

- 그래서 노드는 좀더 복잡한 암호화를 지웒나다.

```js
const crypto = require('crypto');

crypto.randomBytes(64, (err, buf) => {
    const salt = buf.toString('base64');
    console.log('salt',salt);
    crypto.pbkdf2('zerocho바보',salt, 651395 , 64 , 'sha512', (err, key) => {
        console.log('password', key.toString('base64'))
    })
})
```

- 랜덤바이트를 만든다. 64바이트로 버퍼에는 랜덤바이트가 담긴다. 

- 랜덤바이트를 `base64`로 문자열로 만든다 `base64`는 버퍼를 문자열로 만드는 알고리즘 중 하나이다. 

- `salt`는 소금이라고 한다. 

- 해쉬 충돌 공격을 어렵게 하기위해 salt(소금)이라는 문자열을 원래 비밀번호에 추가하고 iteration횟수를 높입니다.

- `pbkdf2`의 첫번쨰 인자는 암호화할 문자을 넣는다. 

- 랜덤 바이트라서 `salt`가 항상 다르다. 

- 100000 이라고 하는 것보다 랜덤한 숫자로 만들어야한다 높을 수록 알아내기 힘들지만 비밀번호 만드느 것도 시간이 걸린다 

- salt는 암호화된 비밀번호와 같이 저장하시고, iteration은 1초 정도가 걸릴 때까지 올려주면 좋습니다.

- `64`는 64바이트 암호문으로 만들겠다는 것 

- 알고리즘은 `sha512`로 만든다는 것이다. 

- 실무에서는 `bcrypt` , `scrypt` 를 사용한다.