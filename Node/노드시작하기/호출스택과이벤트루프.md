# 호출 스택과 이벤트 루프

- 노드 의 핵심적인 개념 3가지 가 있다.
- 이벤트 기반 , 논 블로킹 I/O 모델 , 싱글 쓰레드 이다.
- 이걸 알기 위해서는 이벤트 루프를 알아야한다. 
- 이벤트 루프는 코드가 있다면  어떤 순서로 동작하는지 이해할 수 있나를 말하는 것이다.

```js
function first(){
    second();
    console.log('첫 번째');
}
function second(){
    third();
    console.log('두 번째');
}
function third(){
    console.log('세 번쨰');
}
first();
```

- 코드의 실행 순서 는 세 번째 두 번쨰 첫 번째 이다.
- 선언은 선언 할 것이다 first 함수를 호출하면 first 가 실행이 하는데 second를 호출하는데 실행이 되는데 그 안에 third 호출하면 실행이된다. 
- 그 위에 콘솔로그 가 실행이 된다. 그리고 나간다. third가 끊나면 다시 콘솔 로그 들어갔다가 나간다. 이런 순으로 찍히는 것이다.
- 이러한 스택을 호출 스택 (콜스택) 이라고 한다. 

```js
function run(){
    console.log('3초 후 실행');
}
console.log('시작');
setTimeout(run,3000);
console.log('끝');
```

- 시작 , 끝 , 3초후 실행 
- 콘솔로그는 시작하자마자 빠진다. 
- 아까 first는 함수가 끝나기도 전에 또 다른 함수가 실행되기 때문에 위에 쌓인다
- 애는 시작하자마 끝나버린다.
- setTimeout 도 실행되고 콘솔로그가 실행된다.
- 문제는 run이다. setTimeout은 실행되었는데 run은 어디로 갔는지 모른다. 호출 스택으로 설명이 안된다 그래서 여기서 이벤트 루프라는 개념이 들어간다.
- run이 어디 갔는지 모른다 이때 테스크큐라는 게 나온다 큐는 스택의 반대되는 개념이다.
- 스택은 위에서 부터 사라진다. 큐는 먼저 들어온게 먼저 나간다. 
- 콘솔로그 실행되고 지워진다 셋타임아웃이 실행되면서 run을 지금 실행안하고 테스크큐에 보낸다. 셋타임아웃은 끝난다. 하지만 보낼때 3초뒤에 실행하라고 보낸다.
- 마지막으로 콘솔로그 찍고 끝난다. 그때 호출스택이 비어지고 테스크큐 에는 런 3초가 남아있다. 이벤트 루프역확은 호출스택이 비워지면 테스크큐에서 함수를 꺼내온다.
- 3초 함수 이기때문에 3초가 됐는지 체크를 한다. 그때 호출 스택으로 끌고 가서 실행을 한다. run 실행되고 콘솔로그 실행되고 나간다.
- 이걸 통해서 이벤트 기반 싱글스레드 , 논 블로킹 을 설명할 수 있다.
- 언제 테스크 큐에 들어가나요?
- setTimeout , setInterval , setImmediate , Promise (resolve , reject) async , await , 이벤트 리스너의 콜백 ) 테스트 큐에 들어간다.
- 테스크 큐가 사실은 여러개 이다.
- 큐가 다섯개가 있다고 가정한다면 함수들이 들어가는데 다른큐에 막 들어가다가 어떤 큐에는 2개 3개가 쌓이는데
- 이벤트 루프의 역활은 다섯개의 큐에서 정해진 순서대로 하나씩 꺼내오는 것이다 순서는 이벤트 루프가 알고있다. 다섯개의 큐에서 여러개를 꺼내오는것이 이벤트 루프의 역활이다.
- 위의 큐가 우선순위가 높다면 먼저 호출 스택으로 꺼낸다 그다음 것을 꺼내온다 그때 새치기를 할 수 있다. 우선순위가 높으면 3번째가 있어도 첫번째 우선순위 함수를 실행시킨다.


