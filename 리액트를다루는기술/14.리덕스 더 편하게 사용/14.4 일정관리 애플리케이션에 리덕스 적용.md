# 14.4 일정 관리 애플리케이션에 리덕스 적용

# 14.4.1 준비

기존에 만든 프로젝트에서 리덕스를 사용하려면 먼저 다음 명령어로 필요한 의존 모듈들을 설치해야 합니다.

```bash
yarn add redux react-redux redux-actions immutable
```

그리고 src 디렉토리에 modules와 containers 디렉토리를 생성합니다. modules 디렉토리에는 Ducks구조를 적용한 리덕스 관련 코드를 넣고, containers 디렉토리에는 리덕스 스토어에 연결된 컴포넌트들을 넣을 것입니다.

# 14.4.2 모듈 생성

인풋 상태를 관리하는 input 모듈과 일정들의 상태를 관리하는 todos 모듈을 만들 것입니다.

# 14.4.2.1 input 모듈 생성

이번에 모듈을 만들 때는 이전에 배운 Immutable과 redux-actions를 사용하므로 다음 코드 두 줄로 시작합니다.

```js
// src/modules/input.js
import {Map} from 'immutable';
import {handleActions, createAction} from 'react-actions';
```

리덕스 상태에서 일반 자바스크립트 객체가 아닌 Immutable의 Map 구조를 사용하므로 Immutable 모듈을 불러왔고, handleActions와 createAction을 사용하려고 redux-actions를 불러왔습니다.

인풋 모듈에서는 현재 인풋 내용을 설정하는 액션 하나만 있으면 충분합니다.

```js
// src/modules/input.js
...
const SET_INPUT = "input/SET_INPUT";
```

액션 타입을 정의할 때는 문자열의 앞부분에 리듀서 이름을 적어 줍니다. 이렇게 접두사를 설정했을 때 장점은 액션 타입 이름이 서로 다른 리듀서끼리 중복되어도 상관없다는 것입니다.

액션 타입을 정의하고 나서 createAction을 사용하여 액션 생성 함수를 만듭니다.

```js
// src/modules/input.js
...
export const setInput = createAtion(SET_INPUt);
```

그다음 순서는 리듀서의 초기 상태를 정의하는 것입니다.

```js
// src/modules/input.js
...
const initialState = Map({
    value : ''
})
```

value 값을 Map안에 넣었습니다. 이제 리듀서를 만들 차례입니다. 리듀서는 handleActions를 사용하여 만듭니다.

```js
// src/modules/input.js
export default handleActions({
    [SET_INPUT] : (state, action) => {
        return state.set('value', action.payload)
    }
}, initialState)
```

# 14.4.2.2 todos 모듈 생성

todos 모듈에서 구현할 액션은 다음 세 가지입니다.

- INSERT : 추가
- TOGGLE : 토글
- REMOVE : 삭제

그럼 우선 액션 타입을 정의하고, 액션 생성 함수를 만듭니다.

```js
// src/modules/todos.js
import {Map,List} from 'immutable';
import {handleActions, createAction} from 'react-actions';

const INSERT = 'todos/INSERT';
const TOGGLE = 'todos/TOGGLE';
const REMOVE = 'todos/REMOVE';

export const insert = createAction(INSERT);
export const toggle = createAction(TOGGLE);
export const remove = createAction(REMOVE);
```

그 다음은 리듀서의 기본 상태도 정의 합니다.

```js
// src/modules/todos.js
...
const initialState = List([
    Map({
        id : 0 ,
        text : '리액트 공부하기',
        done : true
    }),
    Map({
        id : 1,
        text : '컴포넌트 스타일링 해보기',
        done : false
    })
])
```

리듀서의 기본 상태는 List로 만들었습니다. 그리고 내부에는 초기에 지니고 있을 일정 데이터 두 개를 Map형태로 넣어 주었습니다.

handleActions를 사용하여 리듀서를 만들어 보겠습니다.

```js
// src/modules/todos.js
...
export default handleActions({
    [INSERT] : (state,action) => {
        /* 
            payload 안에 있는 id, text, done의 레퍼런스를 만들어 줍니다.
            레퍼런스를 만들지 않고 , 바로 push(Map(action.payload))를 해도 되지만,
            나중에 이 코드를 보았을 때 ,
            이 액션이 어떤 데이터를 처리하는지 쉽게 볼수 있돌고 하는 작업입니다.
        */
        const {id, text, done} = action.payload;
        return state.push(Map({
            id,
            text,
            done
        }))
    }, 
    [TOGGLE] : (state,action) => {
        const { payload : id} = action;
        // = const id = action.payload;
        /* 
            비구조화 할당으로 id 레퍼런스에 action.payload 값을 넣습니다.
            이 작업은 필수는 아니지만, 나중에 이 코드를 보았을때 여기에서 payload가 
            어떤 값을 의미하는지 쉽게 이해할 수 있습니다.
        */
        // 전달받은 id 를 가지고 index를 조회합니다.
        const index = state.findIndex(todo => todo.get('id') === id);
        // updateIn으로 현재 값을 참조하여 반대 값으로 설정합니다.
        return state.updateIn([index, 'done'], done => !done );
        /* 
            updateIn을 사용하지 않는다면 다음과 같이 작성할 수 도 있습니다.
            return state.setIn([index,'done'], !state.getIn([index, 'done']))
        */
    },
    [REMOVE] : (state,action) => {
        const {payload : id } = action;
        const index = state.findIndex(todo => todo.get('id') === id);
        return state.delete(index);
    }
}, initialState)
```

# 14.4.2.3 모듈 인덱스 파일 생성

이제 modules 디렉토리에 index.js 파일을 만들고 combineReducers를 사용하여 리듀서를 합쳐서 내보냅니다.

```js
// src/modules/index.js
import input from './input';
import todos from './todos';
import {combineReducers} from 'redux';

export default combineReducers({
    input,
    todos
})
```

# 14.4.3 스토어 생성 및 설정

모듈을 다 만들었으니 index.js에서 리덕스 스토어를 생성하고, Provider로 리액트 프로젝트에 적용해 봅니다.

```js
// src/index.js

import React from 'react';
import ReactDOM from 'react-dom';
import './styles/main.scss';
import App from './components/App';

import modules from './modules';
import {createStore} from 'redux';
import {Provider} from 'react-redux';

const store = createStore(modules, window.devToolsExtension && window.devToolsExtension());

ReactDOM.render(
    <Provider store={store}>
        <App/>
    </Provider>,
    document.getElementById('root')
)
```

