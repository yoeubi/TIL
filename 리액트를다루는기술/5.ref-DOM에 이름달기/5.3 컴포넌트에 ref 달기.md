# 5.3 컴포넌트에 ref 달기

리액트에서는 컴포넌트에도 ref를 달 수 있습니다. 이 방법은 주로 컴포넌트 내부에 있는 DOM을 컴포넌트 외부에서 사용할때 씁니다.

컴포넌트에 ref를 다는 방법은 DOM에 ref를 다는 방법과 동일 합니다.

# 5.3.1 사용법

```js
<MyComponent ref={ref=> this.myComponent = ref}>
```

이렇게 하면 MyComponent 내부의 메서드 및 멤버 변수에도 접근할 수 있습니다. 즉 내부의 ref에도 접근할 수 있습니다. (예: myComponent.handleClick, myComponent.input 등)

이번에는 스크롤 박스가 있는 컴포넌트를 하나 만들고, 스크롤바를 아래로 내리는 작업을 부모 컴포넌트에서 실행합니다.

# 5.3.2 컴포넌트 초기 설정

ScrollBox 라는 컴포넌트 파일을 만듭니다. 그다음 최상위 DOM에 ref를 달습니다.

```js
//ScrollBox.js
import React , {Component} from 'react';

class ScrollBox extends Component {
    render(){
        const style = {
            border : '1px solid black',
            height : '300px',
            width : '300px',
            overflow : 'auto',
            position : 'relative'
        }
        const innerStyle = {
            width : '100%',
            height : '650px',
            background : 'linear-gradient(white, black)'
        }
        return (
            <div 
                style={style}
                ref={ref=> this.box = ref}>
                <div style={innerStyle}/>
            </div>
        )
    }
}
export default ScrollBox;
```

# 5.3.2.2 App 컴포넌트에서 스크롤 박스 컴포넌트 렌더링

```js
// App.js
import React , {Component} from 'react';
import ScrollBox from './ScrollBox';

class App extends Component {
    render(){
        return (
            <div>
                <ScrollBox/>
            </div>
        )
    }
}
export default App;
```

# 5.3.3 컴포넌트에 메서드 생성

컴포넌트에 스크롤바를 맨 아래쪽으로 내리는 메서드를 만듭니다. 

자바스크립트로 스크롤바를 내릴 때는 DOM 노드가 가진 다음 값들을 사용합니다.
    - scrollTop : 세로 스크롤바 위치 
    - scrollHeight : 스크롤 박스 내부의 높이(650px)
    - clientHeight : 스크롤 박스 외부의 높이(300px)

스크롤바를 맨 아래로 내리려면 scrollHeight 에서 clientHeight 높이를 빼면 된다.

```js
// ScrollBox.js
import React , {Component} from 'react';

class ScrollBox extends Component {
    scrollToBottom = () => {
        const {scrollHeight , clientHeight} = this.box;
        this.box.scrollTop = scrollHeight - clientHeight;
    }
    render(){
        ...
    }
}
export default ScrollBox;
```

## ES6의 비구조화 할당 문법

비구조화 할당 문법은 객체에서 특정값을 추출하여 따로 레퍼런스를 만들 때 유용합니다.

```js
const object = {
    foo : 1,
    bar : 2
}
const {foo,bar} = object;
console.log(foo, bar); // 1 2 
```

함수의 파라미터를 설정할 때도 동일하게 적용할 수 있습니다.

```js
const object = {
    foo : 1, 
    bar : 2
}
function print({foo,bar}){
    console.log(foo,bar);
}
print(object); // 1 2 
```

비구조화 할당 문법은 리액트 컴포넌트에서 state나 props를 참조할때 자주 사용합니다.

```js
render(){
    return (
        <div>
            <div>{this.props.name}</div>
            <div>{this.props.number}</div>
        </div>
    )
}
```

props를 참조할 때 마다 this.props를 반복해서 입력해야 한다는 점이 귀찮을 수도 있습니다. 이때 비구조화 할당 문법을 사용하면 됩니다.

```js
render(){
    const {name , number} = this.props;
    return (
        <div>
            <div>{name}</div>
            <div>{number}</div>
        </div>
    )
}
```

이렇게 만든 메서드는 부모 컴포넌트인 App 컴포넌트에서 ScrollBox에 ref를 달면 사용할 수 있습니다.

# 5.3.4 컴포넌트에 ref를 달고 내부 메서드 사용

App 컴포넌트에 ScrollBox에 ref를 달고 버튼을 만들어 누르면 ScrollBox 컴포넌트의 scrollToButtom 메서드를 실행하도록 작성합니다.

```js
// App.js
import React , {Component} from 'react';
import ScrollBox from './ScrollBox';

class App extends Component {
    render(){
        return (
            <div>
                <ScrollBox ref={ref => this.scrollBox = ref} />
                <button onClick={() => this.scrollBox.scrollToBottom()}>맨 밑으로</button>
            </div>
        )
    }
}
export default App;
```

주의할 점이 있습니다. 문법상으로는 onClick = {this.scrollBox.scrollToBottom} 같은 형식으로 해도 틀린 것은 아닙니다.

하지만 컴포넌트가 처음 렌더링될 때는 this.scrollBox 값이 undefined 이므로 this.scrollBox.scrollToBottom 값을 읽어 오는 과정에서 오류가 발생합니다.

화살표 함수 문법을 사용하여 아예 새로운 함수를 만들고, 그 내부에서 this.scrollBox.scrollToBottom 메서드를 실행하면, 버튼을 누를 때 (이미 한 번 렌더링을 해서 this.scrollBox를 설정한 시점) this.scrollBox.scrollToBottom 값을 읽어 와서 실행하므로 오류가 발생하지 않습니다.

# 5.4 정리

컴포넌트 내부에서 DOM에 직접 접근해야 할 때는 ref를 사용합니다. 먼저 ref를 사용하지 않고도 원하는 기능을 구현할 수 있는지 꼭 고려한 후 활용하세요

서로 다른 컴포넌트끼리 데이터를 교류할 때 ref를 사용한다면 이는 잘못 사용된 것입니다. 컴포넌트끼리 데이터를 교류할 때는 언제나 데이터를 부모 자식 흐름으로 교류해야합니다.


